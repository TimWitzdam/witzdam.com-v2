---
import Tool from "../../components/Tool.astro";
import Layout from "../../layouts/Layout.astro";
import { tools } from "../../glob_vars";
import BaseInput from "../../components/BaseInput.astro";
import BaseButton from "../../components/BaseButton.astro";
import Card from "../../components/Card.astro";
import ArrowIcon from "../../../public/icons/link-arrow.svg?raw";

let totalUses = "";

for (const tool of tools) {
  tool.uses = "0";
}

await fetch(`${import.meta.env.PUBLIC_API_ADDRESS}/tools/use-stats`)
  .then((res) => res.json())
  .then((data) => {
    if (data.status !== "ok") {
      totalUses = " Error";
    } else {
      for (const tool of data.data.tools) {
        const foundTool = tools.find(
          (t) => t.url.split("/")[t.url.split("/").length - 1] === tool.slug
        );
        if (foundTool) {
          foundTool.uses = tool.uses;
        }
      }
      totalUses = ` ${data.data.total_uses}`;
    }
  })
  .catch((err) => console.log(err));
---

<title>Tim's Tools</title>
<meta
  name="description"
  content="Tim's Tools is a collection of tools my friends and me found helpful while developing applications. All tools are free to use."
/>
<meta name="og:title" content="Tim's Tools" />
<meta
  name="og:description"
  content="Tim's Tools is a collection of tools my friends and me found helpful while developing applications. All tools are free to use."
/>
<Layout current="/tools">
  <section class="mt-20 max-w-4xl mx-auto px-6">
    <h1 class="font-bold text-4xl text-center mb-4">üõ†Ô∏è Tim's Tools</h1>
    <p class="text-center text-lg mb-6">
      Here's a list of various tools my friends and me found helpful while
      developing stuff.
    </p>
    <p class="text-center">Total uses: {totalUses}</p>
  </section>
  <section class="mt-10 max-w-4xl mx-auto px-6">
    <BaseInput
      id="search"
      type="text"
      placeholder="Search for a tool"
      autocomplete="off"
      fullWidth
    />
    <div class="mt-6 flex flex-col gap-6 md:flex-row">
      <div class="w-full">
        <Card
          rounded1
          noPadding
          link={{ url: "/tools/browse", label: "Browse tools" }}
          animated
        >
          <div class="flex justify-between items-center p-4 px-8">
            <p class="text-xl font-bold">Browse tools</p>
            <div class="rotate-[39.81deg]">
              <Fragment set:html={ArrowIcon} />
            </div>
          </div>
        </Card>
      </div>
      <div class="w-full">
        <Card
          rounded1
          noPadding
          link={{ url: "/tools/categories", label: "Browse categories" }}
          animated
        >
          <div class="flex justify-between items-center p-4 px-8">
            <p class="text-xl font-bold">Browse categories</p>
            <div class="rotate-[39.81deg]">
              <Fragment set:html={ArrowIcon} />
            </div>
          </div>
        </Card>
      </div>
    </div>
  </section>
  <section class="mt-10 max-w-4xl mx-auto px-6">
    <h2 class="font-bold text-4xl mb-10">Most popular</h2>
    <div class="grid md:grid-cols-2 grid-rows-1 gap-4">
      {
        tools.map(
          (tool) =>
            tool.popular && (
              <Tool
                name={tool.name}
                description={tool.description}
                url={tool.url}
                uses={tool.uses?.toString() || "0"}
              />
            )
        )
      }
    </div>
    <a href="/tools/browse" class="mx-auto w-fit block mt-8">
      <BaseButton text="View all" />
    </a>
  </section>
  <section class="mt-20">
    <Card noPadding noRounded>
      <div class="max-w-4xl mx-auto px-6 py-10 text-center">
        <h2 class="font-bold text-4xl mb-4">APIs needed?</h2>
        <p class="md:w-1/2 mx-auto text-lg">
          If you need any of these tools as an API or want to explore more of
          what I do, check out my API collection.
        </p>
        <a href="/api" class="mx-auto w-fit block mt-8">
          <BaseButton text="Explore APIs (coming soon)" />
        </a>
      </div>
    </Card>
  </section>
</Layout>
